---
const categories = await fetch('https://mixmixmix.ch/wp-json/wp/v2/categories')
    .then(res => res.json())
    .catch(err => {
        console.error('Error fetching categories:', err);
        return [];
    });

const isIndexPage = Astro.url.pathname === '/';
---

<header class="min-h-30 md:min-h-41 sticky top-0 backdrop-blur-sm z-20">


<!-- Mobile click indicator -->
<div class="absolute top-4 right-4 md:hidden">
    <span class="text-xs">â­˜ CLICK!!</span>
</div>

<h1 class="p-4 text-center font-bold backdrop-blur-sm">
    <a href="/">JANIS LABHART</a>
</h1>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const worksButton = document.querySelector('.works-dropdown-btn');
        const dropdown = document.querySelector('.works-dropdown');
        const categoryButtons = document.querySelectorAll('.category-btn');
        
        // Toggle dropdown on WORKS click
        worksButton?.addEventListener('click', () => {
            dropdown?.classList.toggle('hidden');
        });
        
        // Handle category button clicks
        categoryButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const targetElement = e.target as HTMLElement;
                const category = targetElement.getAttribute('data-category');
                
                // Remove active state from all buttons
                categoryButtons.forEach(b => b.classList.remove('selected'));
                // Add active state to clicked button
                targetElement.classList.add('selected');
                
                // Dispatch custom event that the index page can listen to
                window.dispatchEvent(new CustomEvent('categoryWorks', { 
                    detail: { category } 
                }));
                ;
            });
        });
    });
</script>

</header>

<nav class="fixed top-0 left-0 p-4 font-bold text-xs md:text-sm z-20">
    <div class="group">
        {isIndexPage ? (
            <button class="works-dropdown-btn cursor-pointer hover:opacity-70">WORKS</button>
        ) : (
            <a href="/" class="hover:opacity-70">WORKS</a>
        )}
        
        {isIndexPage && (
            <div class="works-dropdown hidden transition-all duration-200 z-30 min-w-max">
                <button class="category-btn" data-category="all">ALL</button>
                {categories.map((category: any) => (
                    <button class="category-btn" data-category={category.slug}>
                        {category.name.toUpperCase()}
                    </button>
                ))}
            </div>
        )}
    </div>
    <a href="about">ABOUT</a>
    <a href="calendar">CALENDER</a>
</nav>
