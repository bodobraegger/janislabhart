---
import Layout from '../layouts/Layout.astro';

// Fetch the about page from WordPress
// You can either use a specific page ID or slug
const aboutRes = await fetch("https://mixmixmix.ch/wp-json/wp/v2/pages?slug=about");
const aboutPages = await aboutRes.json();
const aboutPage = aboutPages[0]; // Get the first (and likely only) result

// Fallback if no about page is found
if (!aboutPage) {
  console.error('About page not found in WordPress');
}

// Fetch featured image if it exists
let featuredImage = null;
if (aboutPage?.featured_media) {
  try {
    const mediaRes = await fetch(`https://mixmixmix.ch/wp-json/wp/v2/media/${aboutPage.featured_media}`);
    const media = await mediaRes.json();
    featuredImage = media.source_url;
  } catch (error) {
    console.log('Error fetching featured image:', error);
  }
}

// Extract custom fields if they exist (for contact info, social links, etc.)
const contactEmail = aboutPage?.acf?.contact_email || aboutPage?.meta?.contact_email || 'janislabhart@gmail.com';
const soundcloudUrl = aboutPage?.acf?.soundcloud_url || aboutPage?.meta?.soundcloud_url || '#';
const vimeoUrl = aboutPage?.acf?.vimeo_url || aboutPage?.meta?.vimeo_url || '#';
---

<Layout>
    <!-- Main content area -->
    <main class="about flex justify-center mx-4">
      <div class="w-full max-w-4xl">
        
        {aboutPage ? (
          <>
            <!-- Bio content from WordPress -->
            <div class="prose">
              <div set:html={aboutPage.content.rendered} />
            </div>
          </>
        ) : (
          <!-- Fallback content if WordPress page not found -->
          <div class="text-center">
            <h1 class="text-2xl mb-4">About page not found</h1>
            <p class="text-sm">Please create an "About" page in your CMS.</p>
          </div>
        )}
      </div>
    </main>
</Layout>
